<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" href="%PUBLIC_URL%/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#000000" />
    <meta
      name="description"
      content="Web site created using create-react-app"
    />
    <link rel="apple-touch-icon" href="%PUBLIC_URL%/logo192.png" />
    <link rel="manifest" href="%PUBLIC_URL%/manifest.json" />

    <!-- Naver Map API -->
    <script
      type="text/javascript"
      src="https://openapi.map.naver.com/openapi/v3/maps.js?ncpClientId=키값 "
    ></script>

    <title>React App</title>
  </head>
  <body>
    <noscript>You need to enable JavaScript to run this app.</noscript>
    <div id="root">
      <form id="search-form">
        <label for="start-input">출발지:</label>
        <input type="text" id="start-input" />
        <label for="end-input">목적지:</label>
        <input type="text" id="end-input" />
        <button type="submit">검색</button>
      </form>
      <div id="map" style="min-height: 400px;"></div>
    </div>

    <script>
      // 출발지와 목적지 검색 및 경로 표시 함수
      function searchRoute() {
        var startInput = document.getElementById('start-input');
        var endInput = document.getElementById('end-input');
        var map = new naver.maps.Map('map', {
          zoom: 10,
          zoomControl: true,
          zoomControlOptions: {
            position: naver.maps.Position.TOP_RIGHT,
          },
        });

        // 출발지, 목적지 마커 생성
        var startMarker = new naver.maps.Marker({ map: map });
        var endMarker = new naver.maps.Marker({ map: map });

        // 경로 그리기
        var directions = new naver.maps.Directions({
          map: map,
          // 도로 안내 결과 처리
          renderOptions: {
            preserveViewport: true,
            polylineOptions: {
              strokeColor: '#f00',
              strokeWeight: 5,
            },
          },
        });

        // 검색 버튼 클릭 시 이벤트 처리
        document.getElementById('search-form').addEventListener('submit', function (e) {
          e.preventDefault();

          // 출발지, 목적지 설정
          var start = startInput.value;
          var end = endInput.value;

          // 경로 검색 API 호출
          var apiUrl = `https://naveropenapi.apigw.ntruss.com/map-direction/v1/driving?start=${start}&goal=${end}&option=trafast&key=1o608ovly2 `;

          axios
            .get(apiUrl)
            .then(function (response) {
              var data = response.data;

              // 경로 정보 추출
              var path = data.route.path.map(function (point) {
                return new naver.maps.LatLng(point.latitude, point.longitude);
              });

              // 출발지, 목적지 좌표 설정
              var startLatLng = path[0];
              var endLatLng = path[path.length - 1];

              // 출발지, 목적지 마커 위치 설정
              startMarker.setPosition(startLatLng);
              endMarker.setPosition(endLatLng);

              // 경로 그리기
              directions.route({
                start: startLatLng,
                destination: endLatLng,
                waypoints: [],
              });

              // 출발지, 목적지를 포함한 경로가 보이도록 지도 영역 조정
              var bounds = new naver.maps.LatLngBounds();
              path.forEach(function (latLng) {
                bounds.extend(latLng);
              });
              map.fitBounds(bounds);
            })
            .catch(function (error) {
              console.error(error);
            });
        });
      }

      naver.maps.onJSContentLoaded = function () {
        searchRoute();
      };
    </script>
  </body>
</html>
